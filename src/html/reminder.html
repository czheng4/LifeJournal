<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
	<link href="../../fontawesome/css/all.css" rel="stylesheet">
	<script src="../../node_modules/jquery/dist/jquery.min.js"></script>
	<title></title>
	<style type="text/css">

		.header
		{
			position: absolute;
			width: 90%;
			top:5%;
			left: 5%;
			height: 8%;
			background-color: var(--theme-l2);
			border-top-left-radius: 5px;
			border-top-right-radius: 5px;

		}
		.box
		{
			position: absolute;
			width: 90%;
			top:13%;
			left: 5%;
			height: 80%;
			background-color: var(--panel-color);
			overflow: scroll;
			border-bottom-left-radius: 5px;
			border-bottom-right-radius: 5px;
		}

		pre
		{
			overflow-y: scroll;
			overflow-x: hidden;
			white-space: normal;
			outline: none;
			
			margin-left: 5%;
			display: inline-grid;
		}
		
		i
		{
			margin-left: 5%;
		}
		span
		{
			margin-left: 5%;
		}

		#reminderTitle:empty::before
		{
			content: "Title";
			color:var(--text-color);
		}

		#description:empty::before
		{
			content: "Description";
			cursor: text;
			color:var(--text-color);
		}
		
		a:hover
		{
			color:red;
		}

		.gap
		{
			background-color: white;
			width: 100%;
			height: 10px;
		}
		
		/* alarm */
		.reminder
    	{ 
    		position: absolute;
			width: 70%;
			top:20%;
			left: 15%;
			height: 60%;
			background-color:var(--theme-l1);
			overflow: scroll;
			border-radius: 5px;
			display: none;
			z-index: 2;
    	}
    	input
    	{
    		position: absolute;
    		left: 88%;
    	}
    	input[type="radio"] 
    	{
 			/* https://stackoverflow.com/questions/45327086/how-change-the-color-of-the-radio-button * /
 			
 			/* remove standard background appearance */
  			-webkit-appearance: none;
  			-moz-appearance: none;
  			appearance: none;
  			/* create custom radiobutton appearance */
  			display: inline-block;
  			width: 15px;
  			height: 15px;
  			padding: 3px;
  			/* background-color only for content */
  			background-clip: content-box;
  			border: 1px solid #e7e6e7;
  			background-color: #e7e6e7;
  			border-radius: 50%;
		}

		input[type="radio"]:checked 
		{
  			background-color: red;
		}
    	
    	hr
    	{
    		background-color: var(--hr-line);
    		left:5%;
    		width: 90%;
    	}


    	/* repeat */
    	.repeat,.custom
    	{
    		position: absolute;
			width: 65%;
			top: 15%;
			left: 17.5%;
			height: 70%;
			background-color:var(--theme-l1);
			overflow-x:hidden;
			overflow-y: scroll;
			border-radius: 5px;
			z-index: 2;
			display: none;
    	}

    	/* date picker */
    	body
    	{
        	background-color: var(--background-color);
        	color: var(--text-color);
    	}
    
   		::-webkit-scrollbar 
    	{
        	width: 0px;
    	}

    	.title
    	{
    	    top:15%;
    	    height: 10%;
    	    text-align: center;
    	    font-size: 30px;
    	    position: absolute;
    	    margin-left: 7.5%;
    	    width: 85%;
    	    background-color: var(--theme-l3);
    	    color: var(--text-color);
    	    overflow: scroll;    
    	    border:1px solid;
    	    z-index: 2;
    	}
    	.content
    	{ 
    	    top:25%;
    	    position: absolute;
    	    margin-left: 7.5%;
    	    width: 15%;
    	    background-color: var(--theme-l1);
    	    color: var(--text-color);
    	    max-height: 60%;
    	    overflow: scroll;    
    	    border:1px solid;
    	    border-top: none;
    	    z-index: 2;
    	}
	
    	.content a 
    	{
    	    color: var(--text-color);
    	    padding: 12px 16px;
    	    text-decoration: none;
    	    display: block;
    	}
    	.content a:hover
    	{
    	  background-color: pink;
    	}


    	/* customize the repetition */
    	.dropdown
		{
			border: none;
  			outline: none;
  			padding: 7.5px;
  			background-color: var(--panel-color);
  			color: var(--text-color);
  			position: absolute;
			margin-left: 3%;
			top: 60px;
			width: 40%;
			height: 40px;
			border-radius: 5px;

			cursor: pointer;
			text-align: center;
		}


		.dropDownRepeat
		{
			transition: 0.5s;
			position: absolute;
			margin-left: 3%;
			text-align: center;
			width: 40%;
			top:100px;
  			background-color: var(--background-color);
  			color: var(--text-color);
  			box-shadow: 0px 4px 8px 0px;

  			z-index: 2;
  			max-height: 170px;
  			overflow: scroll;
  			border-bottom-left-radius: 10px;
  			border-bottom-right-radius: 10px;
		}

		.dropDownRepeat a, .numEventDropDownText a
		{
			padding: 8px 16px;
			cursor: pointer;
			display: block;
			text-decoration: none;
		}
		.dropDownRepeat a:hover, .numEventDropDownText a:hover
		{
			background-color: pink;
		}

		.week
		{
			position: absolute;
			top: 290px;
			margin-left: 3%;
			width: 100%;
			transition: 0.5s;
			padding-bottom: 100px;
		}

		.effective
		{
			position: absolute;
			top:30%;
			width: 40%;
			margin-left: 30%;
			height: 40%;
			z-index: 2;
			background-color: var(--theme-l2);
			display: none;
		}

		.numEventDropDown
		{
			border: none;
  			outline: none;
  			padding: 7.5px;
  			background-color: var(--panel-color);
  			color: var(--text-color);
  			position: relative;
			text-align: center;
			margin-left: 30%;
			width: 40%;
			height: 40px;
			border-radius: 5px;
			cursor: pointer;
			transition: 0.5s;
		}

		.numEventDropDownText
		{
  			transition: 0.5s;
			position: relative;
			margin-left: 30%;
			width: 40%;
  			background-color: var(--background-color);
  			color: var(--text-color);
  			box-shadow: 0px 4px 8px 0px;
  			text-align: center;
  			z-index: 2;
  			height: 0;
  			overflow: scroll;
  			border-bottom-left-radius: 10px;
  			border-bottom-right-radius: 10px;
		}

		a
		{
			color: var(--text-color);
		}
	</style>
</head>
<body>

	<!-- datePicker -->
	<div id = "datePicker" style="display: none;">
	
		<div id = "title" class="title">Mon, Dec 2, 2019 7:00AM</div>
    		<div class = "content" id = "date" style="left:0%; border-right: none; width: 40%; font-family: courier">	 
    	</div>
    	
    	<div class = "content" id = "hour" style="left:40%"> 
        <a id = "hour1" href="#">1</a>
        <a id = "hour2" href="#">2</a>
        <a id = "hour3" href="#">3</a>
        <a id = "hour4" href="#">4</a>
        <a id = "hour5" href="#">5</a>
        <a id = "hour6" href="#">6</a>
        <a id = "hour7" href="#">7</a>
        <a id = "hour8" href="#">8</a>
        <a id = "hour9" href="#">9</a>
        <a id = "hour10" href="#">10</a>
        <a id = "hour11" href="#">11</a>
        <a id = "hour12" href="#">12</a>
    	</div>
	
    	<div class = "content" id = "minute" style="left:55%; border-right: none;border-left: none;"> 
        <a href = "#" id = "minute0">00</a>
        <a href = "#" id = "minute1">01</a>
        <a href = "#" id = "minute2">02</a>
        <a href = "#" id = "minute3">03</a>
        <a href = "#" id = "minute4">04</a>
        <a href = "#" id = "minute5">05</a>
        <a href = "#" id = "minute6">06</a>
        <a href = "#" id = "minute7">07</a>
        <a href = "#" id = "minute8">08</a>
        <a href = "#" id = "minute9">09</a>
        <a href = "#" id = "minute10">10</a>
        <a href = "#" id = "minute11">11</a>
        <a href = "#" id = "minute12">12</a>
        <a href = "#" id = "minute13">13</a>
        <a href = "#" id = "minute14">14</a>
        <a href = "#" id = "minute15">15</a>
        <a href = "#" id = "minute16">16</a>
        <a href = "#" id = "minute17">17</a>
        <a href = "#" id = "minute18">18</a>
        <a href = "#" id = "minute19">19</a>
        <a href = "#" id = "minute20">20</a>
        <a href = "#" id = "minute21">21</a>
        <a href = "#" id = "minute22">22</a>
        <a href = "#" id = "minute23">23</a>
        <a href = "#" id = "minute24">24</a>
        <a href = "#" id = "minute25">25</a>
        <a href = "#" id = "minute26">26</a>
        <a href = "#" id = "minute27">27</a>
        <a href = "#" id = "minute28">28</a>
        <a href = "#" id = "minute29">29</a>
        <a href = "#" id = "minute30">30</a>
        <a href = "#" id = "minute31">31</a>
        <a href = "#" id = "minute32">32</a>
        <a href = "#" id = "minute33">33</a>
        <a href = "#" id = "minute34">34</a>
        <a href = "#" id = "minute35">35</a>
        <a href = "#" id = "minute36">36</a>
        <a href = "#" id = "minute37">37</a>
        <a href = "#" id = "minute38">38</a>
        <a href = "#" id = "minute39">39</a>
        <a href = "#" id = "minute40">40</a>
        <a href = "#" id = "minute41">41</a>
        <a href = "#" id = "minute42">42</a>
        <a href = "#" id = "minute43">43</a>
        <a href = "#" id = "minute44">44</a>
        <a href = "#" id = "minute45">45</a>
        <a href = "#" id = "minute46">46</a>
        <a href = "#" id = "minute47">47</a>
        <a href = "#" id = "minute48">48</a>
        <a href = "#" id = "minute49">49</a>
        <a href = "#" id = "minute50">50</a>
        <a href = "#" id = "minute51">51</a>
        <a href = "#" id = "minute52">52</a>
        <a href = "#" id = "minute53">53</a>
        <a href = "#" id = "minute54">54</a>
        <a href = "#" id = "minute55">55</a>
        <a href = "#" id = "minute56">56</a>
        <a href = "#" id = "minute57">57</a>
        <a href = "#" id = "minute58">58</a>
        <a href = "#" id = "minute59">59</a>
    	</div>
    	<div class="content" id = "period" style="left: 70%; height: 60%;">
    	    <a href="#" id ="am">AM</a>
    	    <a href="#" id ="pm">PM</a>
    	</div>
    	<div style="position: absolute; top:70%; left: 79%; z-index: 2">
    	    <button id = "cancel"type="button" class="btn btn-danger" style="width:100px">Cancel</button>
    	</div>
    	<div style="position: absolute; top: 60%; left: 79%;z-index: 2">
    	    <button id = "ok" type="button" class="btn btn-primary" style="width:100px;background-color:green">Ok</	button>
    	</div>
	</div>

	<!-- reminder -->
	<div class="reminder">
		<div style="position: relative;top: 15px; cursor: pointer;">
        	<div> <span>None</span><input type="radio" name = "alram"></div><hr>
        	<div><span>At time of event</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>5 minutes before</span><input type="radio"  name = "alram"> </div><hr>
        	<div><span>10 minutes before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>15 minutes before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>20 minutes before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>25 minutes before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>30 minutes before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>1 hour before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>2 hours before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>1 day before</span><input type="radio"  name = "alram"></div><hr>
        	<div><span>2 days before</span><input type="radio"  name = "alram"></div> <hr>
        	<div><span>1 week before</span><input type="radio"  name = "alram"></div><br>
       	</div>
	</div>

	<div class="repeat">
		<h3 style="margin-left: 4.7%; margin-top: 15px;"><strong>Repeat</strong></h3>
		<div style="position: relative;top: 15px; cursor: pointer;">
        	<div><span>Never</span><input type="radio" name = "repeat"></div><hr>
        	<div><span>Every 1 day</span><input type="radio"  name = "repeat"></div><hr>
        	<div><span>Every 1 week</span><input type="radio"  name = "repeat"> </div><hr>
        	<div><span>Every 1 month</span><input type="radio"  name = "repeat"></div><hr>
        	<div><span>Every 1 year</span><input type="radio"  name = "repeat"></div><hr>
        	<div><span>Custom</span><input type="radio"  name = "repeat"></div>
       	</div>
	</div>


	<!-- cunstom  -->
	<div class="custom" style="padding-bottom: 80px;">
		<div style="margin-top: 15px;">
			<strong style="font-size: 25px; margin-left: 3%">Repeat</strong>
			<strong id = "customHeader" style="position: absolute; right: 35px;font-size:25px;">Every 1 week</strong>
		</div>
		
		<div class = "dropdown" id = "repeatNumberDropDown">
			<span style = "margin-left: 0%" id = "repeatNumberText">1</span>
			<i class="fa fa-caret-down" style="position:absolute; right:10px; font-size: 20px"></i>		
		</div>
		<div class="dropDownRepeat" id = "repeatNumber">
				<a href="#">1</a>
				<a href="#">2</a>
				<a href="#">3</a>
				<a href="#">4</a>
				<a href="#">5</a>
				<a href="#">6</a>
		</div>

		<div class="dropdown" id = "repeatTypeDropDown" style="left: 50%">
			<span id ="repeatTypeText" style="margin-left: 0px">week</span>
			<i class="fa fa-caret-down" style="position:absolute; right:10px; font-size: 20px"></i>		
		</div>
		<div class="dropDownRepeat" id = "repeatType" style="left: 50%">
				<a href="#">day</a>
				<a href="#">week</a>
				<a href="#">month</a>
				<a href="#">year</a>
		</div>
		<div class="week">

			<div id = "days" style="position: relative;top: 15px; cursor: pointer;">
				<div>Sunday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
				<div>Monday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
				<div>Tuesday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>	
				<div>Wednesday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
				<div>Thursday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
				<div>Friday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
				<div>Saturday<input type="checkbox" style="position:absolute; right: 20px"><hr style="margin-left: 0"></div>
			</div>
			
			<div id = "effectiveEntry" style="position:relative; top: 15px; cursor: pointer; width: 97%">
				<span style="margin-left: 0px">Effective</span>
				<span style="position: absolute; right: 7.5%" id = "effectiveText">Forever</span>
			</div>

			<div id = "until_a_date"  style="top: 10px; display: none">
				 <br>
				 <div><input id = "dateUntil" type = "date" style="position: relative; left: 0;font-size: 100%; width: 170px;background: silver"></div>
			</div>
			<div id = "numEvent" style="position: relative;top: 20px; display: none"> 
				<div class="numEventDropDown">
					<span id = "repeatEventText" style="margin-left: 0px">1</span>
					<i class="fa fa-caret-down" style="position:absolute; right:10px; font-size: 20px"></i>	
				</div>

				<div class = "numEventDropDownText">
					<a href="#">1</a>
					<a href="#">2</a>
					<a href="#">3</a>
					<a href="#">4</a>
					<a href="#">5</a>
					<a href="#">6</a>
				</div>
			</div>

			<div style="position: relative;top: 40px; text-align: left;">
				<button id = "cancelCustom" type="button" class="btn btn-primary" style="width: 100px">Cancel</button>
				&nbsp;&nbsp;&nbsp;&nbsp;
				<button id = "okCustom"type="button" class="btn btn-danger" style="width: 100px">Ok</button>
			</div>
		</div>
		
	</div>
	<!-- effective is part of custom -->
	<div class="effective">
		<h3 style = "padding: 20px 0 0 5%">Effective</h3>
		<div id = "effective" style="position: relative;top: 15px; cursor: pointer;">
			<div><span>Forever</span><input type="radio" name = "effective"></div><hr>
        	<div><span>Until a date</span><input type="radio"  name = "effective"></div><hr>
        	<div><span>For a number of events</span><input type="radio"  name = "effective"> </div>
        </div>
	</div>


	<!-- main page -->
	<div class="header">
		<h4 style="margin-top: 1.5%"> 
		<a id = "close" href="#"><i class="fas fa-times"></i></a>
		<span> New Reminder </span>
		<a href="#" id = "save"><i class="fas fa-check" style="position: absolute; left: 85%;"></i></a>
	</h4>
	</div>

	<div class = "box">
		<br>
		<i class="fas fa-heading"></i>

		<pre contenteditable="true" id = "reminderTitle"></pre>
		
		<hr>


		<div id = "startTime" style="cursor: pointer; width: 100%">
			<i class="far fa-clock"></i>
			<span>Start</span>
			<span id = "startTimeText" style="position: absolute; right: 35px"></span>
		</div>
		<hr>
		
		<div id = "endTime" style="cursor: pointer; width: 100%">
			<i class="far fa-clock"></i>
			<span>End</span> &nbsp;
			<span id = "endTimeText" style="position: absolute; right: 35px"></span>
		</div>
		<hr>
		<div id = "alarm" style="cursor: pointer;">
			<i class="far fa-bell"></i>
			<span>ADD REMINDER </span>
		</div>
		<div id = "alarmText" style="margin-left:11.3%"></div>
		
		<hr>
		<i class="far fa-comments"></i>
		<pre contenteditable="true" id = "description"></pre>
		<hr>
		
		<div id ="repeat" style="cursor: pointer; width: 100%">
			<i class="fas fa-sync"></i>
			<span>Repeat</span>
			<span id = "repeatText" style="position: absolute; right: 35px">Never</span>
		</div>
		
	</div>
	<script type="text/javascript">
		const $ = require("jQuery");
		const fs = require("fs");
		const reminderThread = require('electron').ipcRenderer;
		const remote = require('electron').remote;  
		const {Reminder,getReminders} = require("../js/reminder.js");
		const reminder = new Reminder();
		const {Confirmation} = require("../js/confirmation.js");
		const user = remote.getGlobal('share').user; 
		const path = "./data/" + user + "/reminder"; 
		const {File} = require("../js/file.js");
		const {changeThemeMode, loadThemeMode} = require("../js/theme.js");
		loadThemeMode();
		var alarmDict = {
			"At time of event":0,
			"5 minutes before":0,
			"10 minutes before":0,
			"15 minutes before":0,
			"20 minutes before":0,
			"25 minutes before":0,
			"30 minutes before":0,
			"1 hour before":0,
			"2 hours before":0,
			"1 day before":0,
			"2 days before":0,
			"1 week before":0,
		};

		/* get the file path to store the reminder */
		function getFilePath()
		{
			var files = fs.readdirSync(path).sort(function(t1,t2){return parseInt(t1) - parseInt(t2);});
       	 	var fileName;

               
       		if(files.length == 0) fileName = 1;
        	else fileName =  1 + parseInt(files[files.length - 1]);
       		return path + "/" + fileName;
		}

		/* show reminders text */
		function showReminder()
		{
			let string = "";
			$("#alarmText").text("");
			for(key in alarmDict)
			{
				if(alarmDict[key] == 1) string += '<div><hr style="margin-left: 0%;">' + key + '<a href="#"><i class="fas fa-times"></i></a></div>'
			}
			$("#alarmText").append(string);
		}

		$("#startTime").click(function(){
			timeType = "start";
			$("#datePicker").css({"display":"block","z-index":2});
			scrollToToday();
		})

		$("#endTime").click(function(){
			timeType = "end";
			$("#datePicker").css({"display":"block","z-index":2});
			scrollToToday();
		})

		$("#close").click(function(){
			window.location.href = "calendar.html";
			return;
			/* send the message to main.js to open cofimation page */
			var confirmation = new Confirmation(
				"REMINDER_CANCELLATION",     //type
				"Discard",			  //title
				"Are your sure you don't want to save your changes?", // text
				["Cancel","Yes"]   //buttonlabels 
			);
			reminderThread.send("openConfirmation",confirmation);
		})
		reminderThread.on("REMINDER_CANCELLATION",function(){
			console.log("canel");
		})
		

		$("#alarm").click(function(){
			$(".reminder").css({"display":"block"});
		})

		$("#repeat").click(function(){
			$(".repeat").css({"display":"block"});
		})
		
		$('body').on('click',".reminder div div",function(){
			let text = $(this).children("span").text();
			$(this).children("input").prop("checked", true);
			if(text != "None" && alarmDict[text] == 0)
			{
				console.log(text);
				alarmDict[text] = 1;
				showReminder();
			}
			$(".reminder").css("display","none");
		})

		$('body').on('click',".repeat div div",function(){
			let text = $(this).children("span").text();
			$(this).children("input").prop("checked", true);
			$("#repeatText").text(text);
			$(".repeat").css("display","none");
			if(text == "Custom") $(".custom").css("display","block");

		})


		$('body').on('click',"#alarmText a",function(){
			alarmDict[$(this).parent().text()] = 0;
			$(this).parent().remove();
		})


		$("#save").click(function(){
			//window.location.href = "calendar.html";

			let isMissInfo = false;
			if($("#startTimeText").text() == "") isMissInfo = true;
			if($("#endTimeText").text() == "") isMissInfo = true;

			if(isMissInfo == true)
			{
				reminderThread.send("errorMessage","ERROR","Miss the time");
				return;
			}
			reminder.setAlarm(alarmDict);
			reminder.setRepeat($("#repeatText").text());
			reminder.setEffective($("#effectiveText").text());
			reminder.title = $("#reminderTitle").text();
			reminder.description = $("#description").text();
			let filePath = getFilePath();
			reminder.writeToFile(filePath);
			reminder.readFromFile(filePath);
			
			
			if(reminder.alarmTime !== "")
			{
				reminderThread.send("scheduleAlarm",reminder);
			}
			window.location.href = "calendar.html";





		})
		reminderThread.on("changeThemeMode",changeThemeMode);
	</script>
	<script src = "../js/date_picker.js"></script>
	<script src = "../js/customize_repeat.js"></script>
	<script src = "../js/effective.js"></script>
</body>
</html>